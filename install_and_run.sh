#!/bin/bash

# SuperWhisper Simple - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
echo "üöÄ SuperWhisper Simple - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫"
echo "============================================"
echo "‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –≤ –¥–ª–∏–Ω–Ω—ã—Ö –∞—É–¥–∏–æ + —É–ª—É—á—à–µ–Ω–Ω–∞—è –∞–≤—Ç–æ–≤—Å—Ç–∞–≤–∫–∞"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ macOS
if [[ "$OSTYPE" != "darwin"* ]]; then
    echo "‚ùå –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ macOS"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Python 3.11
if ! python3.11 --version >/dev/null 2>&1; then
    echo "‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è Python 3.11"
    echo "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —á–µ—Ä–µ–∑ Homebrew: brew install python@3.11"
    exit 1
fi

# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
if [ ! -d "venv" ]; then
    python3.11 -m venv venv
fi

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
source venv/bin/activate

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ pip
echo "‚¨ÜÔ∏è  –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ pip..."
pip install --upgrade pip

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo "‚¨áÔ∏è  –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
pip install -r requirements.txt

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è –∫—ç—à–∞
echo "üìÅ –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π..."
mkdir -p cache/transcriptions
mkdir -p cache/vad
mkdir -p cache/punctuation
mkdir -p models

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
echo "üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤..."
python test_basic.py
if [ $? -eq 0 ]; then
    echo "‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç"
else
    echo "‚ö†Ô∏è  –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏, –Ω–æ –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
fi

# –¢–µ—Å—Ç –∞–≤—Ç–æ–≤—Å—Ç–∞–≤–∫–∏
echo "üìã –¢–µ—Å—Ç –∞–≤—Ç–æ–≤—Å—Ç–∞–≤–∫–∏..."
python test_auto_paste.py
if [ $? -eq 0 ]; then
    echo "‚úÖ –ê–≤—Ç–æ–≤—Å—Ç–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç"
else
    echo "‚ö†Ô∏è  –ü—Ä–æ–±–ª–µ–º—ã —Å –∞–≤—Ç–æ–≤—Å—Ç–∞–≤–∫–æ–π - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è"
fi

# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –¥–æ—Å—Ç—É–ø–∞
echo ""
echo "üîê –í–ê–ñ–ù–û: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø–∞"
echo "========================================="
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ: System Settings ‚Üí Privacy & Security ‚Üí Accessibility"
echo "2. –ù–∞–∂–º–∏—Ç–µ '+' –∏ –¥–æ–±–∞–≤—å—Ç–µ:"
echo "   ‚Ä¢ Python (/opt/homebrew/bin/python3.11)"
echo "   ‚Ä¢ Terminal (/Applications/Utilities/Terminal.app)"
echo "3. –ü–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫–∏ —Ä—è–¥–æ–º —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏"
echo ""
echo "–û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–π—á–∞—Å? (y/n)"
read -r response
if [[ "$response" =~ ^[Yy]$ ]]; then
    open "x-apple.systempreferences:com.apple.preference.security?Privacy_Accessibility"
    echo "–ù–∞–∂–º–∏—Ç–µ Enter –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π..."
    read -r
fi

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
echo ""
echo "üé§ –ó–∞–ø—É—Å–∫ SuperWhisper Simple"
echo "============================="
echo "‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏:"
echo "   ‚Ä¢ üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –≤ –¥–ª–∏–Ω–Ω—ã—Ö –∞—É–¥–∏–æ"
echo "   ‚Ä¢ üìã –£–ª—É—á—à–µ–Ω–∞ –∞–≤—Ç–æ–≤—Å—Ç–∞–≤–∫–∞ - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ"
echo "   ‚Ä¢ üß† –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Whisper"
echo "   ‚Ä¢ üõ† –î–æ–±–∞–≤–ª–µ–Ω –∞–ª–≥–æ—Ä–∏—Ç–º —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π"
echo ""
echo "‚å®Ô∏è  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:"
echo "   ‚Ä¢ Option + Space - –∑–∞–ø–∏—Å—å/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞"
echo "   ‚Ä¢ –ò–∫–æ–Ω–∫–∞ üé§/üî¥ –≤ —Å—Ç—Ä–æ–∫–µ –º–µ–Ω—é"
echo "   ‚Ä¢ –¢–µ–∫—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫—É—Ä—Å–æ—Ä"
echo ""
echo "üõë –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: Ctrl+C"
echo ""

python superwhisper.py 